{
	"$schema": "https://json-schema.org/draft/2020-12/schema",
	"$id": "file:///.codex/agent-output-operator.schema.json",
	"title": "Codex Operator Output",
	"description": "Structural schema for operator outputs. Operator is a non-coding leaf role intended for command execution, fetching, and inspection tasks without repo writes.",
	"type": "object",
	"required": [
		"ssot_id",
		"protocol_version",
		"task_id",
		"subtask_id",
		"agent_type",
		"workflow_mode",
		"routing_mode",
		"slice_id",
		"attempt",
		"status",
		"summary",
		"blocked",
		"self_check",
		"task_contract",
		"questions",
		"actions",
		"rationale",
		"blocking_reason",
		"allowed_paths"
	],
	"$defs": {
		"task_contract": {
			"type": "object",
			"required": [
				"goal",
				"scope",
				"constraints",
				"expected_output",
				"non_goals",
				"capabilities",
				"writes_repo"
			],
			"properties": {
				"goal": {
					"type": "string",
					"minLength": 1
				},
				"scope": {
					"type": "string",
					"minLength": 1
				},
				"constraints": {
					"type": "array",
					"items": {
						"type": "string",
						"minLength": 1
					}
				},
				"expected_output": {
					"type": "array",
					"items": {
						"type": "string",
						"minLength": 1
					}
				},
				"non_goals": {
					"type": "array",
					"items": {
						"type": "string",
						"minLength": 1
					}
				},
				"capabilities": {
					"type": "array",
					"minItems": 1,
					"items": {
						"type": "string",
						"enum": [
							"repo_inspect",
							"git_ops",
							"net_fetch",
							"command_exec",
							"synthesize"
						]
					}
				},
				"writes_repo": {
					"type": "boolean",
					"const": false
				}
			},
			"additionalProperties": false
		},
		"evidence_check": {
			"type": "object",
			"required": ["name", "command", "status", "evidence"],
			"properties": {
				"name": {
					"type": "string",
					"minLength": 1
				},
				"command": {
					"type": "string",
					"minLength": 1
				},
				"status": {
					"type": "string",
					"enum": ["pass", "fail", "not_applicable"]
				},
				"evidence": {
					"type": "string",
					"minLength": 1
				}
			},
			"additionalProperties": false
		}
	},
	"properties": {
		"ssot_id": {
			"type": "string",
			"minLength": 1
		},
		"protocol_version": {
			"type": "string",
			"const": "2.0"
		},
		"task_id": {
			"type": "string",
			"minLength": 1
		},
		"subtask_id": {
			"type": "string",
			"minLength": 1
		},
		"agent_type": {
			"type": "string",
			"const": "operator"
		},
		"workflow_mode": {
			"type": "string",
			"enum": ["parallel_dispatch", "subagent_task_execution", "mixed"]
		},
		"routing_mode": {
			"type": "string",
			"const": "assistant_nested"
		},
		"slice_id": {
			"type": "string",
			"minLength": 1
		},
		"attempt": {
			"type": "integer",
			"minimum": 1
		},
		"status": {
			"type": "string",
			"enum": ["in_progress", "done", "awaiting_review"]
		},
		"summary": {
			"type": "string",
			"minLength": 1
		},
		"blocked": {
			"type": "boolean"
		},
		"self_check": {
			"type": "object",
			"required": ["status", "command", "evidence"],
			"properties": {
				"status": {
					"type": "string",
					"enum": ["pass", "fail", "not_applicable"]
				},
				"command": {
					"type": "string",
					"minLength": 1
				},
				"evidence": {
					"type": "string",
					"minLength": 1
				}
			},
			"additionalProperties": false
		},
		"task_contract": {
			"$ref": "#/$defs/task_contract"
		},
		"questions": {
			"type": "array",
			"items": {
				"type": "string",
				"minLength": 1
			}
		},
		"actions": {
			"type": "array",
			"minItems": 1,
			"items": {
				"$ref": "#/$defs/evidence_check"
			}
		},
		"rationale": {
			"type": "string",
			"minLength": 1
		},
		"blocking_reason": {
			"type": "string",
			"minLength": 1
		},
		"allowed_paths": {
			"type": "array",
			"minItems": 1,
			"items": {
				"type": "string",
				"minLength": 1,
				"pattern": "^(/|web:|repo:)"
			}
		}
	},
	"allOf": [
		{
			"if": { "properties": { "blocked": { "const": false } } },
			"then": { "properties": { "blocking_reason": { "const": "not_applicable" } } }
		},
		{
			"if": { "properties": { "blocked": { "const": true } } },
			"then": {
				"properties": { "blocking_reason": { "not": { "const": "not_applicable" } } }
			}
		}
	],
	"examples": [
		{
			"ssot_id": "sso-t-2026-02-22",
			"protocol_version": "2.0",
			"task_id": "task-ops-001",
			"subtask_id": "op-1",
			"agent_type": "operator",
			"workflow_mode": "parallel_dispatch",
			"routing_mode": "assistant_nested",
			"slice_id": "slice-op-1",
			"attempt": 1,
			"status": "done",
			"summary": "Collected repository inspection evidence for the orchestrator.",
			"blocked": false,
			"self_check": {
				"status": "pass",
				"command": "rg -n \"protocol_version\" -S codex-multi-agent-protocol/schemas",
				"evidence": "Found expected protocol_version const entries."
			},
			"task_contract": {
				"goal": "Collect evidence by running repo inspection commands.",
				"scope": "Command execution and inspection only; no repo writes.",
				"constraints": ["Do not modify files", "Do not run long-running commands"],
				"expected_output": ["Command outputs with minimal interpretation"],
				"non_goals": ["No code changes"],
				"capabilities": ["repo_inspect", "command_exec", "synthesize"],
				"writes_repo": false
			},
			"questions": [],
			"actions": [
				{
					"name": "Locate relevant schemas",
					"command": "ls codex-multi-agent-protocol/schemas",
					"status": "pass",
					"evidence": "Found orchestrator/auditor/implementer schemas."
				}
			],
			"rationale": "Evidence captured for orchestrator synthesis.",
			"blocking_reason": "not_applicable",
			"allowed_paths": ["repo:."]
		}
	],
	"additionalProperties": false
}
