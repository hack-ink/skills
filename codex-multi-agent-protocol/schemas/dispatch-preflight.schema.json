{
	"$schema": "https://json-schema.org/draft/2020-12/schema",
	"$id": "file:///.codex/dispatch-preflight.schema.json",
	"title": "Codex Dispatch Preflight",
	"description": "Structural schema for Director Dispatch Preflight JSON. Cross-field/runtime invariants are enforced by AGENTS.md.",
	"type": "object",
	"required": ["ssot_id", "ssot", "routing_mode", "subtasks", "scheduler_plan"],
	"properties": {
		"ssot_id": {
			"type": "string",
			"minLength": 1
		},
		"ssot": {
			"type": "object",
			"required": ["goal", "non_goals", "constraints", "acceptance_criteria", "decisions"],
			"properties": {
				"goal": {
					"type": "string",
					"minLength": 1
				},
				"non_goals": {
					"type": "array",
					"items": {
						"type": "string",
						"minLength": 1
					}
				},
				"constraints": {
					"type": "array",
					"items": {
						"type": "string",
						"minLength": 1
					}
				},
				"acceptance_criteria": {
					"type": "array",
					"items": {
						"type": "string",
						"minLength": 1
					}
				},
				"decisions": {
					"type": "array",
					"items": {
						"type": "string",
						"minLength": 1
					}
				}
			},
			"additionalProperties": false
		},
		"routing_mode": {
			"type": "string",
			"const": "assistant_nested"
		},
		"subtasks": {
			"type": "array",
			"minItems": 1,
			"items": {
				"type": "object",
				"required": [
					"task_id",
					"subtask_id",
					"type",
					"delegate_target",
					"allowed_paths",
					"deliverable"
				],
				"properties": {
					"task_id": {
						"type": "string",
						"minLength": 1
					},
					"subtask_id": {
						"type": "string",
						"minLength": 1
					},
					"type": {
						"type": "string",
						"enum": ["read_only", "write"]
					},
					"delegate_target": {
						"type": "string",
						"enum": ["auditor"],
						"description": "Dispatch Preflight subtasks are always delegated to auditor."
					},
					"allowed_paths": {
						"type": "array",
						"minItems": 1,
						"items": {
							"type": "string",
							"minLength": 1,
							"pattern": "^/"
						}
					},
					"deliverable": {
						"type": "string",
						"minLength": 1
					}
				},
				"additionalProperties": false
			}
		},
		"scheduler_plan": {
			"type": "string",
			"const": "windowed"
		}
	},
	"examples": [
		{
			"ssot_id": "sso-t-2026-02-18-director-auditor-orchestrator-implementer",
			"ssot": {
				"goal": "Apply requested file updates with Auditor->Orchestrator->Implementer reviewed execution.",
				"non_goals": ["No unrelated refactors"],
				"constraints": [
					"SSOT frozen during execution",
					"Director delegates to Auditor; Auditor delegates to Orchestrator; Orchestrator delegates to Implementer."
				],
				"acceptance_criteria": [
					"Schema-valid director/auditor/orchestrator chain outputs",
					"Requested files updated"
				],
				"decisions": [
					"Use chain routing compatible with Director->Auditor->Orchestrator->Implementer"
				]
			},
			"routing_mode": "assistant_nested",
			"subtasks": [
				{
					"task_id": "task-brief-001",
					"subtask_id": "s1-brief",
					"type": "read_only",
					"delegate_target": "auditor",
					"allowed_paths": ["/abs/repo"],
					"deliverable": "Implementer-ready execution brief."
				},
				{
					"task_id": "task-write-001",
					"subtask_id": "s2-write",
					"type": "write",
					"delegate_target": "auditor",
					"allowed_paths": ["/abs/repo/path/file.md"],
					"deliverable": "Auditor/Orchestrator-reviewed Implementer execution with evidence."
				}
			],
			"scheduler_plan": "windowed"
		}
	],
	"additionalProperties": false
}
